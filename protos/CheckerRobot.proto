#VRML_SIM R2025a utf8
# CheckerRobot.proto - Alineación Visual/Física Correcta

PROTO CheckerRobot [
  field SFVec3f    translation  0 0 0
  field SFRotation rotation     0 0 1 0
  field SFString   name         "checker_robot"
  field SFColor    color        1 1 1 
  field SFString   controller   "robot_driver"
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller IS controller
    children [
      # --- 1. CUERPO VISUAL ---
      Pose {
        translation 0 0 0.055
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS color
              roughness 0.5
              metalness 0.1
            }
            geometry Cylinder { height 0.06 radius 0.08 }
          }
        ]
      }

      # --- 2. CONECTOR (Para Reinas) ---
      # Altura: 0.055 (centro cuerpo) + 0.03 (mitad altura) = 0.085
      Connector {
        translation 0 0 0.085
        rotation 0 1 0 1.5708 # Apuntando hacia arriba
        name "upper_connector"
        type "symmetric" # Correcto según tu documento
        autoLock TRUE
      }

      # --- 3. SENSORES ---
      GPS { name "gps" }
      Compass { name "compass" }
      Receiver { name "receiver" channel 1 }
      Emitter {
        name "emitter"
        channel 1
      }

      # --- 4. RUEDA IZQUIERDA ---
      # Z = 0.02 (Radio de la rueda) para que toque el suelo
      HingeJoint {
        jointParameters HingeJointParameters { axis 0 1 0 anchor 0 0.06 0.02 }
        device [ RotationalMotor { name "left_motor" maxTorque 15 maxVelocity 15 } ]
        endPoint Solid {
          name "left_wheel"
          translation 0 0.06 0.02
          rotation 1 0 0 1.5708
          children [ DEF W Shape { geometry Cylinder { height 0.01 radius 0.02 } } ]
          boundingObject USE W
          contactMaterial "high_grip_wheel"
          physics Physics { mass 0.05 density -1 }
        }
      }

      # --- 5. RUEDA DERECHA ---
      HingeJoint {
        jointParameters HingeJointParameters { axis 0 1 0 anchor 0 -0.06 0.02 }
        device [ RotationalMotor { name "right_motor"  maxTorque 15 maxVelocity 15 } ]
        endPoint Solid {
          name "right_wheel"
          translation 0 -0.06 0.02
          rotation 1 0 0 1.5708
          children [ USE W ]
          boundingObject USE W
          contactMaterial "high_grip_wheel"
          physics Physics { mass 0.05 density -1 }
        }
      }

      Solid {
        name "front_slider"
        translation 0.07 0 0.005 # Delante
        physics Physics { mass 0.01 density -1 }
        contactMaterial "frictionless_slider"
        boundingObject Sphere { radius 0.005 }
      }
      Solid {
        name "back_slider"
        translation -0.07 0 0.005 # Detrás
        physics Physics { mass 0.01 density -1 }
        contactMaterial "frictionless_slider"
        boundingObject Sphere { radius 0.005 }
      }
    ]

    # --- 6. FÍSICAS DEL ROBOT (BOUNDING OBJECT) ---
    boundingObject Pose {
        translation 0 0 0.055
        children [
            Cylinder { height 0.06 radius 0.08 }
        ]
    }
    
    physics Physics { 
      density -1 
      mass 1.0 
      # Damping para que no vibre ni salga volando
      damping Damping { linear 0.5 angular 0.5 }
    }
  }
}